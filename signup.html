<!DOCTYPE html>
<html lang="en">
    <head>
        <script async src="https://www.googletagmanager.com/gtag/js?id=GTM-NX2QKP76"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());

          gtag('config', 'G-7FN7LEVWXD');
        </script>

        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="shortcut icon" href="/images/ico.ico" type="image/x-icon">
        <link rel="stylesheet" href="/storage/css/index.css">
        <title>Sign Up | Vexplay</title>

        <meta name="description" content="Sign up for Vexplay - an open source games site hosting 500+ games, useful utilities, powerful settings + a clean user interface">
        <meta property="og:site_name" content="Vexplay">
        <meta property="og:title" content="Vexplay Sign Up">
        <meta property="og:type" content="website">
        <meta property="og:description" content="Sign up for Vexplay - an open source games site hosting 500+ games, useful utilities, powerful settings + a clean user interface">
        
        <style>
            .content-side {
                min-height: 100vh;
                justify-content: flex-start;
                padding-top: 40px;
                padding-bottom: 60px;
                box-sizing: border-box;
                position: relative;
            }
            
            .auth-container {
                max-width: 400px;
                margin: 0 auto;
                padding: 20px;
                border: 3px solid var(--border-color2);
                border-radius: 16px;
                background-color: var(--background-color);
            }
            
            .form-group {
                margin-bottom: 15px;
            }
            
            .form-group label {
                display: block;
                margin-bottom: 5px;
                font-size: 16px;
            }
            
            .form-group input {
                width: 100%;
                padding: 12px;
                font-size: 16px;
                border: 2px solid var(--border-color2);
                border-radius: 8px;
                background-color: rgba(0, 0, 0, 0.2); /* Darker background for input */
                color: var(--text-color);
                font-family: var(--font-family);
                box-sizing: border-box; /* Make sure padding doesn't affect width */
                transition: border-color 0.2s, background-color 0.2s;
            }
            
            .form-group input:focus {
                outline: none;
                border-color: var(--hover-color);
                background-color: rgba(0, 0, 0, 0.3); /* Even darker on focus */
            }
            
            .auth-button {
                width: 100%;
                padding: 12px;
                background-color: var(--background-color);
                color: var(--text-color);
                border: 3px solid var(--border-color2);
                border-radius: 8px;
                font-size: 16px;
                cursor: pointer;
                font-family: var(--font-family);
                margin-top: 10px;
                transition: background-color 0.15s ease-in-out;
            }
            
            .auth-button:hover {
                background-color: var(--hover-color);
            }
            
            .auth-divider {
                text-align: center;
                margin: 20px 0;
                position: relative;
            }
            
            .auth-divider::before {
                content: "";
                position: absolute;
                top: 50%;
                left: 0;
                right: 0;
                height: 1px;
                background-color: var(--border-color2);
            }
            
            .auth-divider span {
                position: relative;
                background-color: var(--background-color);
                padding: 0 10px;
                color: var(--text-color);
            }
            
            .google-button {
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 10px;
            }
            
            .google-button img {
                width: 20px;
                height: 20px;
            }
            
            .auth-footer {
                text-align: center;
                margin-top: 20px;
            }
            
            .auth-footer a {
                color: var(--text-color);
                text-decoration: underline;
                transition: color 0.15s;
            }
            
            .auth-footer a:hover {
                color: var(--hover-color);
            }
            
            .auth-error {
                color: #ff6b6b;
                margin-top: 10px;
                margin-bottom: 15px;
                text-align: center;
                padding: 8px;
                border-radius: 8px;
                background-color: rgba(255, 107, 107, 0.1);
                display: none;
            }
            
            .footer-links {
                position: absolute;
                bottom: 20px;
                width: 100%;
                text-align: center;
            }
        </style>
  </head>
  <body>
      <div class="content-side">
          <h1 class="typewriter">Vexplay</h1>
          <h2>create an account</h2>

          <div class="auth-container">
              <div id="signupError" class="auth-error"></div>
              
              <div class="form-group">
                  <label for="email">Email</label>
                  <input type="email" id="email" placeholder="Enter your email">
              </div>
              
              <div class="form-group">
                  <label for="password">Password</label>
                  <input type="password" id="password" placeholder="Enter your password">
              </div>
              
              <div class="form-group">
                  <label for="confirmPassword">Confirm Password</label>
                  <input type="password" id="confirmPassword" placeholder="Confirm your password">
              </div>
              
              <button class="auth-button" id="signupButton">Sign Up</button>
              
              <div class="auth-divider">
                  <span>or</span>
              </div>
              
              <button class="auth-button google-button" id="googleSignupButton">
                  <img src="https://upload.wikimedia.org/wikipedia/commons/c/c1/Google_%22G%22_logo.svg" alt="Google logo">
                  Sign up with Google
              </button>
              
              <div class="auth-footer">
                  <p>Already have an account? <a href="login.html">Login</a></p>
                  <p>Continue as <a href="#" id="guestLoginButton">Guest</a></p>
              </div>
          </div>

          <div class="footer-links">
              <p class="linkp"><a href="index.html">back to homepage</a> â€¢ <a href="https://discord.gg/k9MH6Y875s" target="_blank">discord</a></p>
          </div>
      </div>

      <!-- Firebase SDK -->
      <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-analytics.js";
        import { getAuth, createUserWithEmailAndPassword, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirebaseConfig } from "./storage/js/firebase-config.js";
        
        // Get the encrypted Firebase configuration
        const firebaseConfig = getFirebaseConfig();

        // Initialize Firebase with retry mechanism
        let app, auth, provider;
        
        try {
            app = initializeApp(firebaseConfig);
            const analytics = getAnalytics(app);
            auth = getAuth(app);
            provider = new GoogleAuthProvider();
        } catch (error) {
            // Handle Firebase initialization error
            console.error("Firebase initialization error:", error);
            const errorElement = document.getElementById('signupError');
            errorElement.textContent = "Connection to authentication service failed. Please try again later.";
            errorElement.style.display = "block";
            
            // Add retry button in case of Firebase initialization error
            const retryButton = document.createElement('button');
            retryButton.textContent = "Retry Connection";
            retryButton.className = "auth-button";
            retryButton.style.marginTop = "15px";
            errorElement.parentNode.insertBefore(retryButton, errorElement.nextSibling);
            
            retryButton.addEventListener('click', () => {
                window.location.reload();
            });
        }

        // Network status listener
        window.addEventListener('online', () => {
            const errorElement = document.getElementById('signupError');
            if (errorElement.textContent.includes('connection') || errorElement.textContent.includes('network')) {
                errorElement.textContent = "Connection restored. You can try signing up now.";
                errorElement.style.color = "#4BB543";
                errorElement.style.backgroundColor = "rgba(75, 181, 67, 0.1)";
                setTimeout(() => {
                    errorElement.style.display = "none";
                }, 3000);
            }
        });

        // Email signup
        document.getElementById('signupButton').addEventListener('click', () => {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const errorElement = document.getElementById('signupError');
            
            if (!email || !password || !confirmPassword) {
                errorElement.textContent = "Please fill in all fields";
                errorElement.style.display = "block";
                return;
            }
            
            if (password !== confirmPassword) {
                errorElement.textContent = "Passwords do not match";
                errorElement.style.display = "block";
                return;
            }
            
            if (password.length < 6) {
                errorElement.textContent = "Password must be at least 6 characters";
                errorElement.style.display = "block";
                return;
            }
            
            // Check for internet connection
            if (!navigator.onLine) {
                errorElement.textContent = "No internet connection. Please check your network and try again.";
                errorElement.style.display = "block";
                return;
            }
            
            // Show loading message
            errorElement.textContent = "Creating account...";
            errorElement.style.color = "#ffffff";
            errorElement.style.backgroundColor = "rgba(0, 150, 255, 0.1)";
            errorElement.style.display = "block";
            
            createUserWithEmailAndPassword(auth, email, password)
                .then((userCredential) => {
                    // Signup successful
                    const user = userCredential.user;
                    localStorage.setItem('userLoggedIn', 'true');
                    localStorage.setItem('userEmail', user.email);
                    localStorage.setItem('userId', user.uid);
                    localStorage.setItem('isGuest', 'false');
                    window.location.href = 'index.html';
                })
                .catch((error) => {
                    // Reset error styling
                    errorElement.style.color = "#ff6b6b";
                    errorElement.style.backgroundColor = "rgba(255, 107, 107, 0.1)";
                    
                    // Handle errors
                    const errorCode = error.code;
                    const errorMessage = error.message;
                    console.error(errorCode, errorMessage);
                    
                    if (errorCode === 'auth/email-already-in-use') {
                        errorElement.textContent = "Email already in use";
                    } else if (errorCode === 'auth/invalid-email') {
                        errorElement.textContent = "Invalid email address";
                    } else if (errorCode === 'auth/weak-password') {
                        errorElement.textContent = "Password is too weak";
                    } else if (errorCode === 'auth/network-request-failed') {
                        errorElement.textContent = "Network connection error. Please check your internet connection and try again.";
                    } else {
                        errorElement.textContent = "Signup failed: " + errorMessage;
                    }
                    
                    errorElement.style.display = "block";
                });
        });
        
        // Google signup
        document.getElementById('googleSignupButton').addEventListener('click', () => {
            const errorElement = document.getElementById('signupError');
            
            // Check for internet connection
            if (!navigator.onLine) {
                errorElement.textContent = "No internet connection. Please check your network and try again.";
                errorElement.style.display = "block";
                return;
            }
            
            // Show loading message
            errorElement.textContent = "Connecting to Google...";
            errorElement.style.color = "#ffffff";
            errorElement.style.backgroundColor = "rgba(0, 150, 255, 0.1)";
            errorElement.style.display = "block";
            
            signInWithPopup(auth, provider)
                .then((result) => {
                    // Google signup successful
                    const user = result.user;
                    localStorage.setItem('userLoggedIn', 'true');
                    localStorage.setItem('userEmail', user.email);
                    localStorage.setItem('userId', user.uid);
                    localStorage.setItem('isGuest', 'false');
                    window.location.href = 'index.html';
                })
                .catch((error) => {
                    // Reset error styling
                    errorElement.style.color = "#ff6b6b";
                    errorElement.style.backgroundColor = "rgba(255, 107, 107, 0.1)";
                    
                    // Handle errors
                    const errorCode = error.code;
                    const errorMessage = error.message;
                    console.error(errorCode, errorMessage);
                    
                    if (errorCode === 'auth/network-request-failed') {
                        errorElement.textContent = "Network connection error. Please check your internet connection and try again.";
                    } else {
                        errorElement.textContent = "Google signup failed: " + errorMessage;
                    }
                    
                    errorElement.style.display = "block";
                });
        });
        
        // Guest login - no Firebase, just use localStorage
        document.getElementById('guestLoginButton').addEventListener('click', (e) => {
            e.preventDefault();
            
            // Set guest status in localStorage without using Firebase
            localStorage.setItem('userLoggedIn', 'true');
            localStorage.setItem('isGuest', 'true');
            localStorage.setItem('userEmail', 'guest');
            localStorage.setItem('userId', 'guest-' + Math.random().toString(36).substring(2, 15));
            window.location.href = 'index.html';
        });
      </script>
      
      <script src="storage/js/cloak.js"></script>
      <script src="storage/js/theme.js"></script>
      <script src="storage/js/cookie.js"></script>
  </body>
</html> 